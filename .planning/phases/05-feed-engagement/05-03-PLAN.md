---
phase: 05-feed-engagement
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/feed/like-button.tsx
  - src/components/feed/likers-list.tsx
  - src/components/feed/category-tabs.tsx
  - src/components/feed/category-badge.tsx
  - src/app/(main)/feed/page.tsx
  - src/components/feed/post-card.tsx
autonomous: true

must_haves:
  truths:
    - "User can like and unlike posts with instant feedback"
    - "User can see who liked a post by clicking the count"
    - "Like count is hidden when zero"
    - "Category tabs filter posts when clicked"
    - "Category tabs are hidden when no categories exist"
    - "Posts display their category as colored badge"
  artifacts:
    - path: "src/components/feed/like-button.tsx"
      provides: "Like toggle with optimistic UI"
      min_lines: 50
    - path: "src/components/feed/likers-list.tsx"
      provides: "Displays list of users who liked"
      min_lines: 30
    - path: "src/components/feed/category-tabs.tsx"
      provides: "Horizontal category filter tabs"
      min_lines: 30
    - path: "src/components/feed/category-badge.tsx"
      provides: "Colored category label"
      min_lines: 15
  key_links:
    - from: "src/components/feed/like-button.tsx"
      to: "src/lib/like-actions.ts"
      via: "togglePostLike, toggleCommentLike server actions"
      pattern: "toggle(Post|Comment)Like"
    - from: "src/app/(main)/feed/page.tsx"
      to: "src/components/feed/category-tabs.tsx"
      via: "CategoryTabs component with URL params"
      pattern: "CategoryTabs"
    - from: "src/app/(main)/feed/page.tsx"
      to: "prisma/schema.prisma"
      via: "category filter in post query"
      pattern: "categoryId.*searchParams"
---

<objective>
Build the like system with optimistic updates and category filtering with URL-based tabs.

Purpose: Enable users to like posts and filter by categories per FEED-07 and FEED-08 requirements
Output: Like button with instant feedback, category tabs for filtering, and updated PostCard with engagement features
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-feed-engagement/05-CONTEXT.md
@.planning/phases/05-feed-engagement/05-RESEARCH.md
@.planning/phases/05-feed-engagement/05-01-SUMMARY.md
@src/components/feed/post-card.tsx
@src/app/(main)/feed/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LikeButton and LikersList components</name>
  <files>src/components/feed/like-button.tsx, src/components/feed/likers-list.tsx</files>
  <action>
**Create src/components/feed/like-button.tsx:**
Client component ('use client') with:
- Props: targetId (string), targetType ('post' | 'comment'), initialLiked (boolean), initialCount (number)
- Use useOptimistic hook for instant state updates:
  - State shape: { isLiked: boolean, count: number }
  - Reducer: LIKE adds 1 and sets isLiked true, UNLIKE subtracts 1 and sets isLiked false
- Use useTransition to disable button during pending
- handleClick: determine action (LIKE/UNLIKE), call setOptimistic, then await toggle action
- Icon: Thumbs up outline when not liked, filled when liked (use inline SVG or lucide-react)
- When liked: icon in primary color
- Count display: Only show when count > 0
- Count is clickable and triggers onLikersClick callback prop
- Disabled state during pending (but show optimistic state immediately)

**Create src/components/feed/likers-list.tsx:**
Client component with:
- Props: targetId (string), targetType ('post' | 'comment'), isOpen (boolean), onClose (function)
- Fetch likers when opened using getPostLikers or getCommentLikers server action
- Display as popover or modal with list of user avatars and names
- Use existing Avatar component
- Loading state while fetching
- Close on backdrop click or close button
- Show "No likes yet" if empty (though this shouldn't happen since we only open when count > 0)
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>LikeButton toggles with optimistic UI, disables during pending. LikersList shows who liked when count clicked.</done>
</task>

<task type="auto">
  <name>Task 2: Create CategoryTabs and CategoryBadge components</name>
  <files>src/components/feed/category-tabs.tsx, src/components/feed/category-badge.tsx</files>
  <action>
**Create src/components/feed/category-badge.tsx:**
Simple server component:
- Props: name (string), color (string - hex)
- Render as small pill/badge with:
  - Background: the hex color at low opacity (e.g., 15% opacity)
  - Text: the hex color at full opacity
  - Tailwind: px-2 py-0.5 rounded-full text-xs font-medium
- Use inline styles for dynamic colors: style={{ backgroundColor: `${color}20`, color }}

**Create src/components/feed/category-tabs.tsx:**
Server component:
- Props: categories (array of { id, name, color }), activeCategory (string | null)
- Return null if categories array is empty (hide tabs when no categories exist)
- Render horizontal scrollable row with overflow-x-auto
- "All" tab first: Link to /feed (no query param)
- Category tabs: Link to /feed?category={id}
- Active state:
  - "All" active when activeCategory is null
  - Category active when activeCategory matches category.id
  - Active tab: use category color as background, white text
  - Inactive tab: muted background, hover effect
- Use Link from next/link for navigation
- Preserve page param when switching categories (reset to page 1 or preserve, TBD)

Design:
- Tabs are pill-shaped (rounded-full)
- Gap between tabs (gap-2)
- Horizontal scroll on mobile (overflow-x-auto, hide scrollbar)
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>CategoryTabs renders horizontal filter tabs with active state. CategoryBadge shows category with color.</done>
</task>

<task type="auto">
  <name>Task 3: Update feed page and PostCard with engagement features</name>
  <files>src/app/(main)/feed/page.tsx, src/components/feed/post-card.tsx</files>
  <action>
**Update src/app/(main)/feed/page.tsx:**
1. Get category from searchParams: `searchParams.category` (string | undefined)
2. Fetch all categories: `db.category.findMany({ orderBy: { name: 'asc' } })`
3. Add CategoryTabs above post list, pass categories and activeCategory
4. Filter posts query: Add `where: { categoryId: category || undefined }` (undefined = no filter)
5. Update post query to include:
   - category: { select: { id: true, name: true, color: true } }
   - _count: { select: { comments: true, likes: true } }
   - likes: currentUserId ? { where: { userId: currentUserId }, take: 1 } : false
6. Transform posts to add isLiked boolean: `post.likes?.length > 0`
7. Pass post data with likeCount, commentCount, isLiked, category to PostCard
8. When category filter changes, reset pagination to page 1

**Update src/components/feed/post-card.tsx:**
1. Add to props: likeCount (number), commentCount (number), isLiked (boolean), category (object | null)
2. Add LikeButton component in footer area, pass initialLiked, initialCount, targetType: 'post'
3. Add comment count display: Show comment icon with count (only when > 0)
4. Add CategoryBadge: If post.category exists, show badge near title/metadata
5. Layout footer: Like button | Comment count | Timestamp
6. Make comment count a Link to /feed/[id] (the detail page where comments live)

Note: Convert PostCard to client component ('use client') since it now contains interactive LikeButton.
  </action>
  <verify>npm run build && npm run lint</verify>
  <done>Feed page filters by category via URL params. PostCard shows like button, comment count, and category badge.</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
- [ ] LikeButton shows instant state change on click (optimistic)
- [ ] LikeButton is disabled during server sync
- [ ] Like count hidden when zero
- [ ] Clicking like count opens likers list
- [ ] CategoryTabs hidden when no categories exist
- [ ] Clicking category tab navigates to filtered URL
- [ ] Active category tab has colored background
- [ ] PostCard shows category badge when category exists
- [ ] PostCard shows comment count with link to detail page
</verification>

<success_criteria>
1. Likes toggle instantly with visual feedback
2. Users can see who liked by clicking count
3. Category tabs appear when categories exist
4. Category tabs filter posts via URL params
5. Posts display their category as colored badge
6. PostCard shows like count, comment count
7. Feed is filterable and shareable via URL
</success_criteria>

<output>
After completion, create `.planning/phases/05-feed-engagement/05-03-SUMMARY.md`
</output>
