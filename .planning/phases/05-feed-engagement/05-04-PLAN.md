---
phase: 05-feed-engagement
plan: 04
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/app/(main)/admin/categories/page.tsx
  - src/components/admin/category-form.tsx
  - src/components/admin/category-list.tsx
  - src/components/feed/comment-card.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can create new categories with name and color"
    - "Admin can delete categories"
    - "Non-admin users cannot access category management"
    - "Comments can be liked with same UX as posts"
  artifacts:
    - path: "src/app/(main)/admin/categories/page.tsx"
      provides: "Admin category management page"
      min_lines: 40
    - path: "src/components/admin/category-form.tsx"
      provides: "Category creation form with color picker"
      min_lines: 40
    - path: "src/components/admin/category-list.tsx"
      provides: "List of categories with delete buttons"
      min_lines: 30
  key_links:
    - from: "src/app/(main)/admin/categories/page.tsx"
      to: "src/lib/category-actions.ts"
      via: "getCategories server action"
      pattern: "getCategories"
    - from: "src/components/admin/category-form.tsx"
      to: "src/lib/category-actions.ts"
      via: "createCategory server action"
      pattern: "createCategory"
---

<objective>
Build admin category management interface and add like functionality to comments.

Purpose: Enable admins to manage categories (FEED-09) and complete the like system for comments
Output: Admin category page with CRUD, comment like buttons integrated
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-feed-engagement/05-CONTEXT.md
@.planning/phases/05-feed-engagement/05-RESEARCH.md
@.planning/phases/05-feed-engagement/05-01-SUMMARY.md
@src/lib/category-actions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin category management page</name>
  <files>src/app/(main)/admin/categories/page.tsx</files>
  <action>
Create the admin category management page:

1. **Authorization check at page level:**
   - Get session with getServerSession(authOptions)
   - If no session, redirect to /login
   - Query user role from database
   - If role is not 'admin' or 'owner', redirect to /feed with unauthorized message or show 403

2. **Page layout:**
   - Title: "Category Management"
   - Subtitle: "Create and manage post categories"
   - CategoryForm component for creating new categories
   - CategoryList component showing existing categories

3. **Data fetching:**
   - Fetch all categories using getCategories() server action or direct db query
   - Pass categories to CategoryList

4. **Export generateMetadata:**
   - title: "Category Management | Admin"

Note: This page lives at /admin/categories route. The (main) route group includes it in the main layout with sidebar/header.
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>Admin category page exists with auth check, category form, and category list.</done>
</task>

<task type="auto">
  <name>Task 2: Create CategoryForm and CategoryList admin components</name>
  <files>src/components/admin/category-form.tsx, src/components/admin/category-list.tsx</files>
  <action>
**Create src/components/admin/category-form.tsx:**
Client component ('use client') with:
- Form fields: name (text input), color (native color input type="color")
- Default color value: #6366f1 (indigo)
- Submit button: "Create Category"
- Use useTransition for pending state
- Call createCategory server action with FormData
- Show error message if creation fails
- Clear form on success
- Input styling consistent with existing form components

**Create src/components/admin/category-list.tsx:**
Client component ('use client') with:
- Props: categories array (id, name, color, _count.posts optional)
- Display as list/table with columns: Color swatch, Name, Post count (if available), Actions
- Color swatch: small rounded square with the category color
- Delete button for each category:
  - Use inline confirmation pattern (isConfirmingId state)
  - Show "Delete" button, when clicked show "Are you sure? Confirm | Cancel"
  - Call deleteCategory server action
  - Warning text: "Posts in this category will become uncategorized"
- Empty state: "No categories yet. Create your first category above."
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>CategoryForm creates categories with color picker. CategoryList shows categories with delete confirmation.</done>
</task>

<task type="auto">
  <name>Task 3: Add like button to comments</name>
  <files>src/components/feed/comment-card.tsx, src/components/feed/comment-list.tsx</files>
  <action>
**Update src/components/feed/comment-list.tsx:**
1. Update the comment query to include like information:
   - _count: { select: { likes: true } }
   - likes: currentUserId ? { where: { userId: currentUserId }, take: 1 } : false
2. Transform comments to add isLiked boolean and likeCount
3. Pass likeCount and isLiked to CommentCard

**Update src/components/feed/comment-card.tsx:**
1. Add to props: likeCount (number), isLiked (boolean)
2. Import and add LikeButton component:
   - targetType: 'comment'
   - targetId: comment.id
   - initialLiked: isLiked
   - initialCount: likeCount
3. Position like button in comment footer, after timestamp
4. Layout: Author info | Content | Footer (timestamp, like button, edit/delete actions)

The comment now has the same like UX as posts - instant feedback with optimistic updates.
  </action>
  <verify>npm run build && npm run lint</verify>
  <done>Comments display like button with optimistic updates. Like count visible when > 0.</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
- [ ] Admin page redirects non-admin users
- [ ] Category form creates category with name and color
- [ ] Native color picker works for color selection
- [ ] Category list shows color swatch, name, delete button
- [ ] Delete uses inline confirmation pattern
- [ ] Comments display like button
- [ ] Comment likes work with same UX as post likes
</verification>

<success_criteria>
1. Admin can access /admin/categories page
2. Non-admin users are redirected
3. Admin can create categories with custom colors
4. Admin can delete categories with confirmation
5. Comments have working like buttons
6. Entire engagement system is complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-feed-engagement/05-04-SUMMARY.md`
</output>
