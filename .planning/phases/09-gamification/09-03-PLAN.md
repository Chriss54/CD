---
phase: 09-gamification
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/gamification/level-badge.tsx
  - src/components/gamification/points-display.tsx
  - src/components/profile/member-card.tsx
  - src/components/feed/post-card.tsx
  - src/components/feed/comment-card.tsx
  - src/app/(main)/members/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can see their current level and total points on profile"
    - "Level badge appears next to user names in posts and comments"
    - "Level badge appears in member directory cards"
    - "Progress bar shows points toward next level"
  artifacts:
    - path: "src/components/gamification/level-badge.tsx"
      provides: "Reusable level badge component"
      exports: ["LevelBadge"]
    - path: "src/components/gamification/points-display.tsx"
      provides: "Points and progress bar for profile"
      exports: ["PointsDisplay"]
    - path: "src/components/profile/member-card.tsx"
      provides: "Member card with level badge"
      contains: "LevelBadge"
    - path: "src/components/feed/post-card.tsx"
      provides: "Post card with author level badge"
      contains: "LevelBadge"
    - path: "src/components/feed/comment-card.tsx"
      provides: "Comment card with author level badge"
      contains: "LevelBadge"
  key_links:
    - from: "src/components/gamification/points-display.tsx"
      to: "src/lib/gamification-config.ts"
      via: "getPointsToNextLevel import"
      pattern: "getPointsToNextLevel"
    - from: "src/app/(main)/members/[id]/page.tsx"
      to: "src/components/gamification/points-display.tsx"
      via: "PointsDisplay component"
      pattern: "PointsDisplay"
---

<objective>
Create level badge and points display components, integrate badges into posts, comments, and member cards.

Purpose: Users can see their level and progress, and level badges appear next to names throughout the app.
Output: LevelBadge component, PointsDisplay with progress bar, updated member-card/post-card/comment-card.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-gamification/09-CONTEXT.md
@.planning/phases/09-gamification/09-RESEARCH.md
@.planning/phases/09-gamification/09-01-SUMMARY.md
@src/lib/gamification-config.ts
@src/components/profile/member-card.tsx
@src/components/feed/post-card.tsx
@src/components/feed/comment-card.tsx
@src/app/(main)/members/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LevelBadge and PointsDisplay components</name>
  <files>src/components/gamification/level-badge.tsx, src/components/gamification/points-display.tsx</files>
  <action>
Create the gamification components directory and two components:

**src/components/gamification/level-badge.tsx:**
```typescript
interface LevelBadgeProps {
  level: number;
  size?: 'sm' | 'md';
}

export function LevelBadge({ level, size = 'sm' }: LevelBadgeProps) {
  const sizeClasses = {
    sm: 'text-xs px-1.5 py-0.5',
    md: 'text-sm px-2 py-1',
  };

  return (
    <span
      className={`
        inline-flex items-center rounded-full
        bg-primary/10 text-primary font-medium
        ${sizeClasses[size]}
      `}
    >
      Lvl {level}
    </span>
  );
}
```

Per CONTEXT.md: All level badges same style, only number changes (no color progression).

**src/components/gamification/points-display.tsx:**
```typescript
import { getPointsToNextLevel } from '@/lib/gamification-config';

interface PointsDisplayProps {
  points: number;
  level: number;
}

export function PointsDisplay({ points, level }: PointsDisplayProps) {
  const progress = getPointsToNextLevel(points, level);

  return (
    <div className="space-y-2">
      {/* Current stats */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-muted-foreground">Level {level}</span>
        <span className="text-sm font-medium">{points} points</span>
      </div>

      {/* Progress bar (if not max level) */}
      {progress && (
        <div className="space-y-1">
          <div
            className="h-2 bg-muted rounded-full overflow-hidden"
            role="progressbar"
            aria-valuenow={progress.current}
            aria-valuemin={0}
            aria-valuemax={progress.required}
            aria-label={`${progress.current} of ${progress.required} points to Level ${level + 1}`}
          >
            <div
              className="h-full bg-primary transition-all duration-300"
              style={{ width: `${Math.min(progress.progress, 100)}%` }}
            />
          </div>
          <p className="text-xs text-muted-foreground text-center">
            {progress.current}/{progress.required} pts to Level {level + 1}
          </p>
        </div>
      )}

      {/* Max level message */}
      {!progress && (
        <p className="text-xs text-muted-foreground text-center">
          Max level reached!
        </p>
      )}
    </div>
  );
}
```

Per CONTEXT.md: Progress bar shows "240/500 pts to Level 4" format.
  </action>
  <verify>
TypeScript compiles without errors.
Components can be imported from other files.
  </verify>
  <done>LevelBadge and PointsDisplay components created with proper styling and accessibility</done>
</task>

<task type="auto">
  <name>Task 2: Add level badges to member-card, post-card, and comment-card</name>
  <files>src/components/profile/member-card.tsx, src/components/feed/post-card.tsx, src/components/feed/comment-card.tsx</files>
  <action>
Update each component to include the LevelBadge next to user names:

**member-card.tsx:**
1. Update MemberCardProps interface to include `level: number`
2. Import LevelBadge from '@/components/gamification/level-badge'
3. Add LevelBadge after member name:
```tsx
<div className="flex items-center gap-2">
  <p className="font-medium text-foreground truncate">
    {member.name || 'Anonymous'}
  </p>
  <LevelBadge level={member.level} size="sm" />
</div>
```

**post-card.tsx:**
1. Update PostWithAuthor type usage to include author.level (need to update the query in feed page too, but that's done automatically if User model includes level)
2. Import LevelBadge from '@/components/gamification/level-badge'
3. Add LevelBadge after author name in header:
```tsx
<Link href={`/members/${post.author.id}`} className="font-medium hover:underline truncate">
  {post.author.name}
</Link>
<LevelBadge level={post.author.level} size="sm" />
{category && (
  <CategoryBadge name={category.name} color={category.color} />
)}
```

**comment-card.tsx:**
1. Update CommentCardProps comment interface to include `authorLevel: number`
2. Import LevelBadge from '@/components/gamification/level-badge'
3. Add LevelBadge after author name:
```tsx
<span className="font-medium text-sm">{comment.authorName || 'Anonymous'}</span>
<LevelBadge level={comment.authorLevel} size="sm" />
```

Note: The components need their interfaces updated to accept level data. The pages that use these components will need to pass the level prop (this happens automatically if Prisma queries select the level field).
  </action>
  <verify>
TypeScript compiles without errors: `npm run build`.
View feed page - posts show level badges next to author names.
View post detail - comments show level badges next to author names.
View members page - member cards show level badges next to names.
  </verify>
  <done>Level badges appear next to names in posts, comments, and member directory cards</done>
</task>

<task type="auto">
  <name>Task 3: Add PointsDisplay to profile page</name>
  <files>src/app/(main)/members/[id]/page.tsx</files>
  <action>
Update the member profile page to show points and level progress:

1. Import PointsDisplay from '@/components/gamification/points-display'
2. Ensure the Prisma query selects `points` and `level` fields (User model already has these)
3. Add PointsDisplay component to the profile page, in a prominent location (e.g., below the bio section or in a sidebar card):

```tsx
{/* Gamification stats */}
<div className="border rounded-lg p-4">
  <h3 className="font-medium mb-3">Progress</h3>
  <PointsDisplay points={user.points} level={user.level} />
</div>
```

Also add a larger LevelBadge near the user's name in the profile header:
```tsx
<div className="flex items-center gap-3">
  <h1 className="text-2xl font-bold">{user.name}</h1>
  <LevelBadge level={user.level} size="md" />
</div>
```
  </action>
  <verify>
Visit a user's profile page.
Verify level badge appears next to name.
Verify points and progress bar are visible.
Progress bar shows correct values based on user's points.
  </verify>
  <done>Profile page shows user level, total points, and progress bar to next level</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Visit /feed - posts show level badges next to author names
3. Visit /feed/[postId] - comments show level badges next to author names
4. Visit /members - member cards show level badges
5. Visit /members/[id] - profile shows level badge, points, and progress bar
6. Progress bar correctly shows points toward next level
</verification>

<success_criteria>
- LevelBadge component exists and renders "Lvl N" badge
- PointsDisplay component shows points and progress bar
- Post author names have level badge next to them
- Comment author names have level badge next to them
- Member directory cards show level badge
- Profile page shows level (large badge), total points, and progress bar
- Max level users see "Max level reached!" instead of progress bar
</success_criteria>

<output>
After completion, create `.planning/phases/09-gamification/09-03-SUMMARY.md`
</output>
