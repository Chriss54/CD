---
phase: 03-profiles
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/profile/member-card.tsx
  - src/components/profile/member-grid.tsx
  - src/components/ui/pagination.tsx
  - src/app/(main)/members/page.tsx
  - src/app/(main)/onboarding/page.tsx
  - src/components/profile/onboarding-form.tsx
  - src/middleware.ts
autonomous: true

must_haves:
  truths:
    - "User can browse paginated member directory"
    - "New users complete profile onboarding after registration"
    - "Pagination allows jumping to specific pages"
  artifacts:
    - path: "src/app/(main)/members/page.tsx"
      provides: "Member directory with pagination"
    - path: "src/components/ui/pagination.tsx"
      provides: "Reusable pagination component"
      exports: ["Pagination"]
    - path: "src/app/(main)/onboarding/page.tsx"
      provides: "Post-registration profile setup"
  key_links:
    - from: "src/app/(main)/members/page.tsx"
      to: "prisma.user"
      via: "paginated query"
      pattern: "db\\.user\\.findMany.*skip.*take"
    - from: "src/components/ui/pagination.tsx"
      to: "URL searchParams"
      via: "page parameter"
      pattern: "searchParams.*page"
---

<objective>
Create member directory with pagination and post-registration onboarding flow.

Purpose: Users can discover other community members (PROF-04) and new users set up their profile after registration (PROF-01).
Output: Paginated member directory at /members, onboarding flow at /onboarding, reusable pagination component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-profiles/03-RESEARCH.md
@.planning/phases/03-profiles/03-01-SUMMARY.md

# Existing patterns
@src/components/auth/register-form.tsx
@src/components/ui/avatar.tsx
@src/middleware.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Pagination component and member display components</name>
  <files>src/components/ui/pagination.tsx, src/components/profile/member-card.tsx, src/components/profile/member-grid.tsx</files>
  <action>
**pagination.tsx** - URL-based pagination:
- 'use client'
- Props: currentPage (number), totalPages (number)
- Use usePathname and useSearchParams hooks
- createPageURL function: update 'page' param in URL
- Render Previous/Next buttons with Link components
- Disable Previous when page 1, Next when last page
- Show "Page X of Y" in center
- Style with flex, gap, Button component for links

**member-card.tsx** - Individual member display:
- Props: member { id, name, image, bio }
- Link wrapper to /members/{id}
- Avatar component (md size)
- Name as primary text
- Bio snippet (truncate to ~100 chars with ellipsis)
- Hover state for interactivity
- Card styling: border, rounded, p-4, hover:shadow

**member-grid.tsx** - Grid layout:
- Props: members array
- CSS Grid: 1 col on mobile, 2 cols md, 3 cols lg
- Map members to MemberCard components
- Handle empty state: "No members yet"
  </action>
  <verify>TypeScript compiles. Components render without errors.</verify>
  <done>Pagination navigates via URL params. MemberGrid displays members in responsive grid.</done>
</task>

<task type="auto">
  <name>Task 2: Create member directory page with pagination</name>
  <files>src/app/(main)/members/page.tsx</files>
  <action>
**members/page.tsx** - Server component with pagination:
- Define ITEMS_PER_PAGE = 12
- Accept searchParams: Promise<{ page?: string }>
- Await searchParams, parse page number (default 1)
- Calculate skip = (page - 1) * ITEMS_PER_PAGE
- Parallel queries with Promise.all:
  - db.user.findMany: skip, take ITEMS_PER_PAGE, orderBy createdAt desc, select { id, name, image, bio }
  - db.user.count() for total
- Calculate totalPages = Math.ceil(total / ITEMS_PER_PAGE)
- Render:
  - Page title "Members" with total count
  - MemberGrid component with members
  - Pagination component if totalPages > 1
- Style: max-w-6xl mx-auto, py-8
  </action>
  <verify>npm run build passes. Page shows members with pagination. Page param changes results.</verify>
  <done>Member directory at /members shows paginated list of all community members</done>
</task>

<task type="auto">
  <name>Task 3: Create onboarding flow for new users</name>
  <files>src/app/(main)/onboarding/page.tsx, src/components/profile/onboarding-form.tsx, src/middleware.ts</files>
  <action>
**onboarding-form.tsx** - Client component:
- Similar to ProfileForm but simplified for first-time setup
- Fields: name (pre-filled from registration), avatar upload, bio (optional)
- On submit: call updateProfile, then router.push('/')
- Welcoming copy: "Welcome! Let's set up your profile"
- Skip button that just redirects to / (profile completion is optional)

**onboarding/page.tsx** - Server component:
- Get session, redirect to /login if not authenticated
- Fetch user to check if profile already complete (has name set beyond default)
- If profile complete, redirect to /
- Render OnboardingForm with user data

**middleware.ts** - Add onboarding to public routes:
- Update matcher regex to exclude 'onboarding' from protected routes
- Pattern: login|register|forgot-password|reset-password|onboarding

NOTE: Do NOT auto-redirect to onboarding after registration. User should see their dashboard first, then choose to complete profile. Onboarding is a manual navigation from a prompt/banner (future enhancement).
  </action>
  <verify>npm run build passes. /onboarding page accessible. Middleware allows unauthenticated access to auth pages.</verify>
  <done>New users can access /onboarding to complete their profile setup</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. /members shows paginated grid of community members
3. Pagination links work: ?page=2 shows different members
4. MemberCard links to /members/{id} profile page
5. /onboarding page loads for authenticated users
6. Onboarding form submits and redirects to home
</verification>

<success_criteria>
- Member directory shows 12 members per page in responsive grid
- Pagination controls navigate between pages via URL
- Total member count displayed
- Clicking member card navigates to their profile
- Onboarding page accessible for profile setup
- Onboarding form allows setting name, avatar, bio
</success_criteria>

<output>
After completion, create `.planning/phases/03-profiles/03-03-SUMMARY.md`
</output>
