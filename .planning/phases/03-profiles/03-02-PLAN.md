---
phase: 03-profiles
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ui/avatar.tsx
  - src/components/profile/avatar-upload.tsx
  - src/components/profile/profile-form.tsx
  - src/components/profile/bio-textarea.tsx
  - src/app/(main)/profile/edit/page.tsx
  - src/app/(main)/members/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can edit their own profile (name, bio, avatar)"
    - "User can view any member's public profile"
    - "Avatar displays with fallback initials when no image"
  artifacts:
    - path: "src/components/ui/avatar.tsx"
      provides: "Reusable avatar component with fallback"
      exports: ["Avatar"]
    - path: "src/components/profile/profile-form.tsx"
      provides: "Profile edit form"
      exports: ["ProfileForm"]
    - path: "src/app/(main)/profile/edit/page.tsx"
      provides: "Profile edit page"
    - path: "src/app/(main)/members/[id]/page.tsx"
      provides: "Public profile view page"
  key_links:
    - from: "src/components/profile/profile-form.tsx"
      to: "profile-actions"
      via: "form action"
      pattern: "updateProfile|uploadAvatar"
    - from: "src/app/(main)/members/[id]/page.tsx"
      to: "prisma.user"
      via: "server component query"
      pattern: "db\\.user\\.findUnique"
---

<objective>
Create profile edit page and public profile view page with avatar component.

Purpose: Users can manage their own profile and view other members' profiles - core PROF-01, PROF-02, PROF-03 requirements.
Output: Profile edit form, avatar upload component, public profile page, reusable avatar component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-profiles/03-RESEARCH.md
@.planning/phases/03-profiles/03-01-SUMMARY.md

# Existing patterns
@src/components/auth/login-form.tsx
@src/lib/profile-actions.ts
@src/lib/validations/profile.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable Avatar and BioTextarea components</name>
  <files>src/components/ui/avatar.tsx, src/components/profile/bio-textarea.tsx</files>
  <action>
**avatar.tsx** - Reusable avatar display:
- Props: src (string | null), name (string | null), size ('sm' | 'md' | 'lg'), className
- Sizes map: sm=32, md=48, lg=96 pixels
- If src exists: render next/image with rounded-full, object-cover
- If no src: render div with initials (first letter of each word in name, max 2), bg-muted background
- Use cn() for className merging

**bio-textarea.tsx** - Character-counted textarea:
- Props: defaultValue, maxLength (default 500), error string
- 'use client' for local state
- useState for value, compute charCount with newline normalization
- Show character counter (charCount/maxLength), red if over limit
- Name attribute 'bio' for form submission
- Match existing input styling from login-form.tsx
  </action>
  <verify>TypeScript compiles. Components render without errors.</verify>
  <done>Avatar shows image or initials fallback. BioTextarea shows live character count.</done>
</task>

<task type="auto">
  <name>Task 2: Create AvatarUpload and ProfileForm components</name>
  <files>src/components/profile/avatar-upload.tsx, src/components/profile/profile-form.tsx</files>
  <action>
**avatar-upload.tsx** - Client component for file upload:
- 'use client'
- Props: currentAvatarUrl, userName (for fallback display)
- Hidden file input (accept image/*), styled label as upload button
- Preview current avatar using Avatar component
- onChange: validate file (type, size < 5MB), create FormData, call uploadAvatar server action
- Show loading state during upload
- Use useRouter().refresh() after successful upload

**profile-form.tsx** - Profile edit form:
- 'use client'
- Props: user object with name, bio, image
- Use react-hook-form with zodResolver and profileSchema
- Include AvatarUpload component at top
- Name input (required, 2-50 chars)
- BioTextarea for bio
- Submit calls updateProfile server action via form action
- Show success message briefly after save
- Follow login-form.tsx patterns for error display and Button usage
  </action>
  <verify>TypeScript compiles. Form validates on submit.</verify>
  <done>ProfileForm handles name/bio edits with validation. AvatarUpload handles file selection and upload.</done>
</task>

<task type="auto">
  <name>Task 3: Create profile edit page and public profile view page</name>
  <files>src/app/(main)/profile/edit/page.tsx, src/app/(main)/members/[id]/page.tsx</files>
  <action>
**profile/edit/page.tsx** - Server component:
- Get session via getServerSession(authOptions)
- Redirect to /login if not authenticated
- Fetch user data: db.user.findUnique with select { id, name, bio, image }
- Render page with title "Edit Profile" and ProfileForm component
- Pass user data to ProfileForm

**members/[id]/page.tsx** - Public profile view:
- Server component with params: { id: string }
- Fetch user: db.user.findUnique where id, select { id, name, bio, image, createdAt }
- If user not found: call notFound()
- Display:
  - Avatar component (lg size) centered
  - Name as heading
  - Bio text (or "No bio yet" placeholder)
  - "Member since {date}" footer
- Add "Edit Profile" link if viewing own profile (compare session.user.id)
- Style with Tailwind: max-w-2xl mx-auto, card-like container
  </action>
  <verify>npm run build passes. Pages render correctly. Profile edit requires auth. Public profile shows for any user.</verify>
  <done>Users can edit their profile at /profile/edit and view any profile at /members/[id]</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. /profile/edit redirects to login when not authenticated
3. /profile/edit shows form with current user data when authenticated
4. /members/{userId} shows public profile for any user
5. Avatar shows image when set, initials when not
6. Bio character counter works and shows limit
</verification>

<success_criteria>
- User can navigate to /profile/edit and see their current profile data
- User can update name and bio, changes persist
- User can upload avatar, image appears after upload
- User can visit /members/{anyUserId} to see public profile
- Avatar component shows initials fallback when no image
- Bio textarea shows character count with 500 limit
</success_criteria>

<output>
After completion, create `.planning/phases/03-profiles/03-02-SUMMARY.md`
</output>
