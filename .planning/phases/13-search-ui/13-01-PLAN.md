---
phase: 13-search-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/components/search/search-bar.tsx
  - src/components/search/search-result-card.tsx
autonomous: true

must_haves:
  truths:
    - "SearchBar renders an input field with placeholder showing keyboard shortcut"
    - "SearchBar focuses on Cmd+K / Ctrl+K keyboard shortcut"
    - "SearchBar navigates to /search?q={query} on form submit"
    - "SearchResultCard renders title, type badge, and snippet"
    - "SearchResultCard links to correct destination based on type"
  artifacts:
    - path: "src/components/search/search-bar.tsx"
      provides: "Client component for header search input"
      exports: ["SearchBar"]
    - path: "src/components/search/search-result-card.tsx"
      provides: "Individual search result display"
      exports: ["SearchResultCard"]
  key_links:
    - from: "src/components/search/search-bar.tsx"
      to: "/search?q="
      via: "router.push on form submit"
      pattern: "router\\.push.*search\\?q="
    - from: "src/components/search/search-result-card.tsx"
      to: "/feed/, /members/, /classroom/courses/"
      via: "Link href based on type"
      pattern: "href=\\{.*\\(result\\.id\\)"
---

<objective>
Create the core search UI components: SearchBar for the header with keyboard shortcut support, and SearchResultCard for displaying individual results.

Purpose: These components are the building blocks for the search interface, enabling users to initiate searches and view results.
Output: Two reusable components ready to be integrated into the header and search page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-search-ui/13-CONTEXT.md
@.planning/phases/13-search-ui/13-RESEARCH.md
@src/lib/search-actions.ts
@src/components/leaderboard/leaderboard-tabs.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install use-debounce package</name>
  <files>package.json, package-lock.json</files>
  <action>
    Install the use-debounce package for debouncing search input:

    ```bash
    npm install use-debounce
    ```

    This is the official Next.js tutorial recommendation for input debouncing - small footprint (<1KB), hooks-based API.
  </action>
  <verify>Run `npm ls use-debounce` and confirm version 10.x is installed</verify>
  <done>use-debounce appears in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create SearchBar component</name>
  <files>src/components/search/search-bar.tsx</files>
  <action>
    Create a client component for the header search input with these features:

    1. Always-visible input field (not icon-expand or modal per CONTEXT.md)
    2. Placeholder text: "Search... ⌘K"
    3. Keyboard shortcut: Cmd+K (Mac) / Ctrl+K (Windows/Linux) focuses the input
    4. On form submit (Enter key): navigate to /search?q={query} using router.push
    5. Use useRef for input focus handling
    6. Use local state for input value (not synced with URL)

    Implementation pattern from RESEARCH.md:
    ```typescript
    'use client';

    import { useRouter } from 'next/navigation';
    import { useState, useEffect, useRef } from 'react';

    export function SearchBar() {
      const router = useRouter();
      const inputRef = useRef<HTMLInputElement>(null);
      const [query, setQuery] = useState('');

      // Keyboard shortcut handler
      useEffect(() => {
        function handleKeyDown(e: KeyboardEvent) {
          if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            inputRef.current?.focus();
          }
        }
        document.addEventListener('keydown', handleKeyDown);
        return () => document.removeEventListener('keydown', handleKeyDown);
      }, []);

      const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        if (query.trim()) {
          router.push(`/search?q=${encodeURIComponent(query.trim())}`);
        }
      };

      return (
        <form onSubmit={handleSubmit}>
          <input
            ref={inputRef}
            type="text"
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder="Search... ⌘K"
            className="..."
          />
        </form>
      );
    }
    ```

    Styling: Match existing input styles in the codebase. Use appropriate sizing for header placement (not too wide, roughly 200-250px).

    IMPORTANT: Use encodeURIComponent for the query to handle special characters properly.
  </action>
  <verify>
    1. File exists at src/components/search/search-bar.tsx
    2. Component exports SearchBar
    3. TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>SearchBar component renders input with placeholder, has keyboard shortcut handler, and navigates on submit</done>
</task>

<task type="auto">
  <name>Task 3: Create SearchResultCard component</name>
  <files>src/components/search/search-result-card.tsx</files>
  <action>
    Create a component to display individual search results with:

    1. Import SearchResult type from search-actions.ts
    2. Link wrapper for the entire card (clickable to navigate)
    3. Type configuration object mapping type to label and href pattern:
       - post -> "Post", /feed/{id}
       - user -> "Member", /members/{id}
       - course -> "Course", /classroom/courses/{id}
    4. Card layout: title, type badge, and snippet in a compact design
    5. Use dangerouslySetInnerHTML for snippet (contains <mark> tags from ts_headline)
    6. Add CSS for mark tag highlight (yellow background per CONTEXT.md)

    Type configuration pattern:
    ```typescript
    const TYPE_CONFIG = {
      post: { label: 'Post', href: (id: string) => `/feed/${id}` },
      user: { label: 'Member', href: (id: string) => `/members/${id}` },
      course: { label: 'Course', href: (id: string) => `/classroom/courses/${id}` },
    } as const;
    ```

    Card structure:
    - Border, rounded corners, padding
    - Hover state with shadow
    - Focus state with ring for accessibility
    - Title truncated if too long
    - Type badge (small, muted background)
    - Snippet with line-clamp-2 to limit height

    Note: The snippet HTML is safe because ts_headline only adds <mark> tags to content that was already sanitized plainText extracted from Tiptap.
  </action>
  <verify>
    1. File exists at src/components/search/search-result-card.tsx
    2. Component exports SearchResultCard
    3. TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>SearchResultCard displays title, type badge, highlighted snippet, and links to correct destination</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Both components exist in src/components/search/
2. TypeScript compiles without errors: `npx tsc --noEmit`
3. use-debounce is installed: `npm ls use-debounce`
</verification>

<success_criteria>
- use-debounce package installed
- SearchBar component handles keyboard shortcut and form submission
- SearchResultCard component displays result data with proper linking
- All TypeScript compiles successfully
</success_criteria>

<output>
After completion, create `.planning/phases/13-search-ui/13-01-SUMMARY.md`
</output>
