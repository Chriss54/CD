---
phase: 13-search-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/search/search-tabs.tsx
  - src/app/(main)/search/page.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "User sees search results page at /search?q={query}"
    - "User can filter results by content type (All, Posts, Members, Courses)"
    - "Empty search (no query) shows placeholder prompting user to enter query"
    - "No results state shows helpful suggestions"
    - "Tabs show counts for each type"
  artifacts:
    - path: "src/components/search/search-tabs.tsx"
      provides: "Type filter tabs with counts"
      exports: ["SearchTabs"]
    - path: "src/app/(main)/search/page.tsx"
      provides: "Search results page with URL state"
      exports: ["default"]
  key_links:
    - from: "src/app/(main)/search/page.tsx"
      to: "search-actions.ts"
      via: "search() server action call"
      pattern: "search\\("
    - from: "src/components/search/search-tabs.tsx"
      to: "/search?q=...&type="
      via: "Link href with query params"
      pattern: "href=.*search\\?q="
---

<objective>
Create the search results page with URL-based state for query and type filtering, plus the SearchTabs component for filtering by content type.

Purpose: Users can view and filter search results through a shareable, bookmarkable URL-based interface.
Output: A working /search page that displays results from the search server action with type filtering.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-search-ui/13-CONTEXT.md
@.planning/phases/13-search-ui/13-RESEARCH.md
@src/lib/search-actions.ts
@src/components/leaderboard/leaderboard-tabs.tsx
@src/components/ui/empty-state.tsx
@src/app/(main)/leaderboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SearchTabs component</name>
  <files>src/components/search/search-tabs.tsx</files>
  <action>
    Create a client component for type filtering tabs following the LeaderboardTabs pattern:

    1. Fixed tab order: All, Posts, Members, Courses
    2. Display counts next to each tab: "Posts (12)"
    3. Use URL search params for state (?type= query param)
    4. Preserve the query param when switching tabs
    5. "All" tab should NOT have a type param (default)

    Props interface:
    ```typescript
    interface SearchTabsProps {
      counts: {
        all: number;
        post: number;
        user: number;
        course: number;
      };
    }
    ```

    Type configuration:
    ```typescript
    const TYPES = [
      { id: 'all', label: 'All' },
      { id: 'post', label: 'Posts' },
      { id: 'user', label: 'Members' },
      { id: 'course', label: 'Courses' },
    ] as const;
    ```

    URL pattern:
    - All tab: /search?q={query}
    - Other tabs: /search?q={query}&type={type}

    Follow LeaderboardTabs styling exactly:
    - Container: flex gap-1 p-1 bg-muted rounded-lg
    - Active tab: bg-background text-foreground shadow-sm
    - Inactive tab: text-muted-foreground hover:text-foreground

    IMPORTANT: Wrap in Suspense boundary requirement - this component uses useSearchParams, so it must be wrapped in Suspense at the page level.
  </action>
  <verify>
    1. File exists at src/components/search/search-tabs.tsx
    2. Component exports SearchTabs
    3. TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>SearchTabs renders four tabs with counts, updates URL on click, preserves query param</done>
</task>

<task type="auto">
  <name>Task 2: Create search results page</name>
  <files>src/app/(main)/search/page.tsx, src/app/globals.css</files>
  <action>
    Create the /search page as a Server Component with the following structure:

    1. Read searchParams (async in Next.js 15+): query (q) and type filter
    2. Call search() server action with the query
    3. Filter results by type if type param is present
    4. Calculate counts per type for SearchTabs
    5. Handle states: empty query, no results, error, loading

    Page structure:
    ```typescript
    import { Suspense } from 'react';
    import { search } from '@/lib/search-actions';
    import { SearchTabs } from '@/components/search/search-tabs';
    import { SearchResultCard } from '@/components/search/search-result-card';
    import { EmptyState } from '@/components/ui/empty-state';

    interface SearchPageProps {
      searchParams: Promise<{ q?: string; type?: string }>;
    }

    export default async function SearchPage({ searchParams }: SearchPageProps) {
      const params = await searchParams;
      const query = params.q || '';
      const typeFilter = params.type;

      // Empty query state
      if (!query) {
        return (
          <div className="max-w-2xl mx-auto py-8">
            <div className="text-center py-12 text-muted-foreground">
              Enter a search term to find posts, members, and courses.
            </div>
          </div>
        );
      }

      const result = await search(query);

      // Error state
      if ('error' in result) {
        return <EmptyState title="Search failed" description={result.error} />;
      }

      // Calculate counts and filter
      // ...
    }
    ```

    Empty/no results states per CONTEXT.md:
    - Empty query: "Enter a search term to find posts, members, and courses."
    - No results: "No results for '{query}'. Try different keywords or check spelling."
    - Filtered tab with zero: "No {type} found" (e.g., "No posts found")

    Results display:
    - Single column list layout (full width, easy to scan)
    - Map filtered results to SearchResultCard components
    - Show duration for debugging (optional, can be removed later)

    CSS addition for mark tag highlighting:
    Add to globals.css:
    ```css
    /* Search result highlighting */
    mark {
      background-color: rgb(254 240 138); /* yellow-200 */
      color: inherit;
      padding: 0 2px;
      border-radius: 2px;
    }
    ```

    Suspense boundary:
    Wrap SearchTabs in Suspense since it uses useSearchParams:
    ```tsx
    <Suspense fallback={<div className="h-10" />}>
      <SearchTabs counts={counts} />
    </Suspense>
    ```

    IMPORTANT:
    - Use encodeURIComponent when displaying query in error message to prevent XSS
    - Filter client-side from full results (max 50) - don't make separate server calls per type
  </action>
  <verify>
    1. Directory exists: src/app/(main)/search/
    2. File exists: src/app/(main)/search/page.tsx
    3. CSS mark styles added to globals.css
    4. TypeScript compiles: `npx tsc --noEmit`
    5. Page accessible at /search (run dev server and navigate)
  </verify>
  <done>Search page displays results, handles empty/no-results states, supports type filtering via URL</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. SearchTabs component exists and exports correctly
2. Search page accessible at /search
3. Empty query shows placeholder message
4. Search with query shows results with type tabs
5. Type filtering works via URL params
6. mark tag has yellow highlight styling
7. TypeScript compiles: `npx tsc --noEmit`
</verification>

<success_criteria>
- /search page loads without errors
- Empty query state displays helpful message
- Search results display with type tabs
- Type filtering updates URL and filters results
- No results state shows suggestions
- Highlighted snippets have yellow background
</success_criteria>

<output>
After completion, create `.planning/phases/13-search-ui/13-02-SUMMARY.md`
</output>
