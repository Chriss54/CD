# Milestone v1.1: Global Search

**Status:** ✅ SHIPPED 2026-01-24
**Phases:** 12-13
**Total Plans:** 5

## Overview

Global search enables users to find posts, members, and courses through a unified search interface. Phase 12 establishes the search infrastructure using PostgreSQL Full-Text Search with tsvector columns and GIN indexes. Phase 13 delivers the user-facing search bar, results page, and empty states.

## Phases

### Phase 12: Search Infrastructure

**Goal**: Search queries execute against indexed content with ranked results
**Depends on**: Phase 11 (v1.0 complete)
**Plans**: 2 plans

Plans:
- [x] 12-01: Schema, migration, and Tiptap text extraction utility
- [x] 12-02: Post integration, backfill, and unified search action

**Details:**

Requirements addressed:
- SRCH-01: Database supports full-text search with tsvector columns and GIN indexes
- SRCH-02: Post content (Tiptap JSON) is extractable and searchable as plain text
- SRCH-03: Search queries return results in under 100ms for typical queries
- SRCH-09: Results are ranked by relevance (title match > content match)

Technical implementation:
- PostgreSQL FTS with `to_tsvector()` and `websearch_to_tsquery()`
- tsvector columns on Post, User (profile), and Course tables
- GIN indexes for query performance
- Plain text extraction from Tiptap JSON for Post search_vector
- `ts_rank()` with weight 'A' for title, 'B' for content
- Prisma `$queryRaw` for FTS queries (ORM doesn't use indexes properly)

### Phase 13: Search UI & Results

**Goal**: Users can search and browse results through an intuitive interface
**Depends on**: Phase 12
**Plans**: 3 plans

Plans:
- [x] 13-01: Search components (SearchBar, SearchResultCard) and use-debounce install
- [x] 13-02: Search page with tabs, URL state, and empty states
- [x] 13-03: Header integration and final verification

**Details:**

Requirements addressed:
- SRCH-04: User can access search from persistent search bar in header
- SRCH-05: User can search across posts, members, and courses from single input
- SRCH-06: User sees search results page at /search?q={query}
- SRCH-07: User can filter results by content type (All, Posts, Members, Courses)
- SRCH-08: Results show relevant snippet with matched text context
- SRCH-10: User can click result to navigate to full content
- SRCH-11: Empty search shows placeholder prompting user to enter query
- SRCH-12: No results state shows helpful suggestions

Technical implementation:
- SearchBar as Client Component with Cmd+K / Ctrl+K keyboard shortcut
- /search page with URL-based state for shareability
- Server Actions for search queries (matches existing pattern)
- Content type tabs filter results client-side (max 50 results)
- Yellow highlight on matched words via `<mark>` tags

---

## Milestone Summary

**Key Decisions:**

- Use PostgreSQL FTS (built into Supabase, no external service)
- Extract Tiptap JSON to plain text for search indexing
- Use GENERATED ALWAYS AS for auto-updating tsvector columns
- Weight A for titles/names, weight B for descriptions/content
- Extract plainText on write (not read) for search indexing
- Use websearch_to_tsquery for user-friendly query syntax
- Limit search results to 50 to prevent over-fetching
- Type filter uses URL query param for shareable/bookmarkable results
- Filtering done client-side from full results (max 50)

**Issues Resolved:**

- Database drift from previous `db push` usage (resolved with manual migration)
- Prisma client regeneration needed after schema changes
- Search input text visibility in dark mode (fixed with explicit color classes)

**Issues Deferred:**

- Autocomplete/live search (SRCH-14) — use-debounce installed, ready for future
- Recent searches history (SRCH-15) — deferred to v1.2+

**Technical Debt Incurred:**

- use-debounce package installed but not currently used (for future live search feature)

---

_For current project status, see .planning/ROADMAP.md_

---
*Archived: 2026-01-24 as part of v1.1 milestone completion*
